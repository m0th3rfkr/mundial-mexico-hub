%% DIAGRAMA 3: FLUJO COMPLETO - PARTIDOS + EQUIPOS
%% Sistema Core para Mundial 2026 con Live Matches

graph TB
    Start([Usuario en Mundial 2026 App])
    
    %% SECCIÃ“N PARTIDOS
    Start --> PartidosTab[ğŸ“… TAB: PARTIDOS]
    
    PartidosTab --> MatchScreen[EXPLORAR PARTIDOS<br/>Nivel 1]
    
    MatchScreen --> DatePicker[ğŸ“… Date Picker<br/>â—€ 6 nov 2025 â–¶]
    DatePicker --> DateLogic{Fecha seleccionada}
    
    DateLogic --> ShowMatches[Mostrar partidos<br/>de esa fecha]
    
    MatchScreen --> LiveDetection{Â¿Hay partidos<br/>EN VIVO?}
    LiveDetection -->|SÃ| LiveFilter[ğŸ”´ LIVE FILTER<br/>Auto-activa]
    LiveDetection -->|NO| NoLive[Sin filtro live]
    
    LiveFilter --> FilteredList[Lista solo partidos LIVE<br/>Ordenados por fase]
    NoLive --> AllList[Todos los partidos del dÃ­a<br/>Ordenados por hora]
    
    ShowMatches --> MatchCard1[CARD: Cuartos de Final<br/>Estadio Azteca, CDMX]
    MatchCard1 --> Match1[ğŸ‡¬ğŸ‡­ GHA  01:15  MEX ğŸ‡²ğŸ‡½<br/>Ghana vs MÃ©xico<br/>â­ Favorito]
    
    ShowMatches --> MatchCard2[CARD: Semifinal<br/>Estadio BBVA, Monterrey]
    MatchCard2 --> Match2[ğŸ‡§ğŸ‡· BRA  19:00  ARG ğŸ‡¦ğŸ‡·<br/>Brasil vs Argentina]
    
    ShowMatches --> MoreMatches[... mÃ¡s partidos]
    
    %% DETALLE DE PARTIDO
    Match1 --> MatchDetail[DETALLE PARTIDO<br/>Nivel 2]
    Match2 --> MatchDetail
    MoreMatches --> MatchDetail
    
    MatchDetail --> MatchInfo[InformaciÃ³n Completa]
    MatchInfo --> TeamFlags[ğŸ‡¬ğŸ‡­ Ghana vs MÃ©xico ğŸ‡²ğŸ‡½]
    MatchInfo --> MatchTime[ğŸ• Hora: 01:15 CDMX]
    MatchInfo --> Stadium[ğŸŸï¸ Estadio Azteca<br/>Ciudad de MÃ©xico]
    MatchInfo --> Phase[Fase: Cuartos de Final]
    
    MatchDetail --> LiveCheck{Â¿Partido<br/>EN VIVO?}
    LiveCheck -->|SÃ| LiveBadge[ğŸ”´ LIVE<br/>Minuto 67']
    LiveCheck -->|NO| NoLiveBadge[PrÃ³ximamente<br/>o Finalizado]
    
    LiveBadge --> FutureFeature[FUTURO:<br/>Updates minute-by-minute<br/>desde API-Football]
    
    MatchDetail --> TableBtn[Ver Tabla de Grupo]
    TableBtn --> GroupTable[Tabla de Posiciones<br/>Grupo seleccionado]
    GroupTable --> BackToMatch[[â† Volver a Partido]]
    
    MatchDetail --> FavMatch[â­ Guardar Favorito]
    FavMatch --> FavDB[(Sistema Favoritos<br/>Supabase)]
    
    %% SECCIÃ“N EQUIPOS
    Start --> EquiposMenu[âš½ MENÃš â†’ EQUIPOS]
    
    EquiposMenu --> TeamScreen[EQUIPOS<br/>Nivel 1]
    
    TeamScreen --> TeamFilters[FILTROS CONFEDERACIONES]
    TeamFilters --> FilterAll[Todos - 32 equipos]
    TeamFilters --> FilterUEFA[UEFA - Europa]
    TeamFilters --> FilterCONMEBOL[CONMEBOL - SudamÃ©rica]
    TeamFilters --> FilterCONCACAF[CONCACAF - NorteamÃ©rica]
    
    FilterAll --> TeamGrid[GRID 2x2<br/>Lista de Equipos]
    FilterUEFA --> TeamGrid
    FilterCONMEBOL --> TeamGrid
    FilterCONCACAF --> TeamGrid
    
    TeamGrid --> Team1[ğŸ‡©ğŸ‡ª Alemania GER]
    TeamGrid --> Team2[ğŸ‡¸ğŸ‡¦ Arabia Saudita KSA]
    TeamGrid --> Team3[ğŸ‡©ğŸ‡¿ Argelia ALG]
    TeamGrid --> Team4[ğŸ‡¦ğŸ‡· Argentina ARG]
    TeamGrid --> Team5[ğŸ‡¦ğŸ‡º Australia AUS]
    TeamGrid --> Team6[ğŸ‡§ğŸ‡· Brasil BRA]
    TeamGrid --> MoreTeams[... 26 equipos mÃ¡s]
    
    %% DETALLE DE EQUIPO
    Team4 --> TeamDetail[DETALLE EQUIPO<br/>Nivel 2]
    
    TeamDetail --> BackToTeams[[â† Volver a Equipos]]
    TeamDetail --> TeamHeader[ğŸ‡¦ğŸ‡· Argentina<br/>CONMEBOL â€¢ Grupo -]
    
    TeamHeader --> PlayerSection[JUGADORES]
    
    PlayerSection --> Player1[CARD #4<br/>Carlitos MunguÃ­a<br/>ğŸ“¸ Medio - wtfk<br/>âš½ 0  ğŸŸ¥ 0]
    PlayerSection --> Player2[CARD #11<br/>Ãngel Di MarÃ­a<br/>ğŸ“¸ Extremo derecho<br/>Rosario Central<br/>âš½ 0  ğŸŸ¥ 0]
    PlayerSection --> Player3[CARD #10<br/>Lionel Messi<br/>ğŸ“¸ Delantero<br/>Inter Miami<br/>âš½ 15  ğŸŸ¥ 2]
    PlayerSection --> MorePlayers[... mÃ¡s jugadores]
    
    %% DETALLE DE JUGADOR
    Player2 --> PlayerDetail[DETALLE JUGADOR<br/>Nivel 3]
    Player3 --> PlayerDetail
    
    PlayerDetail --> BackToTeam[[â† Volver al Equipo]]
    PlayerDetail --> PlayerPhoto[ğŸ“¸ FOTO GRANDE]
    PlayerDetail --> PlayerName[Ãngel Di MarÃ­a]
    PlayerDetail --> PlayerPos[Extremo derecho]
    
    PlayerDetail --> PlayerInfo[INFORMACIÃ“N]
    PlayerInfo --> Age[EDAD: 37]
    PlayerInfo --> Club[CLUB: Rosario Central]
    PlayerInfo --> Height[ALTURA: 178 cm]
    PlayerInfo --> Weight[PESO: 70 kg]
    
    PlayerDetail --> Stats[ESTADÃSTICAS WC2026]
    Stats --> Goals[âš½ 0 Goles]
    Stats --> Assists[ğŸ¯ 0 Asistencias]
    Stats --> Minutes[â±ï¸ 0 Minutos jugados]
    Stats --> Yellow[ğŸŸ¨ 0 Amarillas]
    Stats --> Red[ğŸŸ¥ 0 Rojas]
    
    %% BACKEND Y LÃ“GICA
    Backend[(SUPABASE DATABASE)]
    Backend --> MatchesTable[matches<br/>â€¢ 64 partidos WC2026<br/>â€¢ kick_off_time<br/>â€¢ stadium<br/>â€¢ phase]
    Backend --> TeamsTable[teams<br/>â€¢ 32 equipos<br/>â€¢ confederation<br/>â€¢ group<br/>â€¢ flag]
    Backend --> PlayersTable[players<br/>â€¢ ~736 jugadores<br/>â€¢ team_id<br/>â€¢ position<br/>â€¢ stats]
    
    MatchScreen -.Fetch.-> MatchesTable
    TeamGrid -.Fetch.-> TeamsTable
    PlayerSection -.Fetch.-> PlayersTable
    
    %% LÃ“GICA LIVE MATCH
    LiveLogic[LÃ“GICA PARTIDO EN VIVO]
    LiveLogic --> CheckTime{IF match.kick_off_time<br/><= NOW<br/>AND<br/>NOW <= kick_off + 120min}
    CheckTime -->|TRUE| DisplayLive[Display: ğŸ”´ LIVE badge<br/>Update: Minute counter<br/>Filter: Show in Live filter]
    CheckTime -->|FALSE| DisplayNormal[Display: Normal<br/>Sin badge live]
    
    %% API INTEGRATIONS
    API[INTEGRACIONES API]
    API --> APIFootball[API-Football<br/>Live match data<br/>Events/Goals/Cards]
    API --> FootballData[Football-Data.org<br/>Teams/Players info]
    API --> ProxyService[Proxy Service<br/>live-service-v2.onrender.com]
    
    FutureFeature -.-> ProxyService
    ProxyService -.-> APIFootball
    ProxyService -.-> FootballData
    
    %% FEATURES ADICIONALES
    Features[CARACTERÃSTICAS ESPECIALES]
    Features --> AutoRefresh[Auto-refresh<br/>durante partidos live]
    Features --> PushNotif[FUTURO: Push notifications<br/>para favoritos]
    Features --> MinByMin[FUTURO: Min-by-min feed<br/>Goals, cards, substitutions]
    
    %% DATOS TÃ‰CNICOS
    TechData[DATOS TÃ‰CNICOS<br/>â€¢ 64 partidos totales WC2026<br/>â€¢ 13 partidos en MÃ©xico<br/>â€¢ 32 selecciones<br/>â€¢ ~736 jugadores<br/>â€¢ 3 sedes MÃ©xico: CDMX, GDL, MTY<br/>â€¢ DetecciÃ³n live automÃ¡tica<br/>â€¢ Filtros por confederaciÃ³n<br/>â€¢ Sistema de favoritos<br/>â€¢ IntegraciÃ³n APIs externas]
    
    %% STYLING
    classDef partidosStyle fill:#93284F,stroke:#2C5530,stroke-width:4px,color:#fff,font-weight:bold
    classDef equiposStyle fill:#2C5530,stroke:#93284F,stroke-width:4px,color:#fff,font-weight:bold
    classDef liveStyle fill:#ff0000,stroke:#fff,stroke-width:3px,color:#fff,font-weight:bold
    classDef detailStyle fill:#FFD700,stroke:#93284F,stroke-width:2px,color:#333
    classDef backendStyle fill:#e8f4f8,stroke:#2C5530,stroke-width:2px,color:#333
    classDef apiStyle fill:#f0e6ff,stroke:#93284F,stroke-width:2px,color:#333
    classDef actionStyle fill:#fff,stroke:#93284F,stroke-width:2px,color:#93284F,stroke-dasharray: 5 5
    
    class PartidosTab,MatchScreen,MatchCard1,MatchCard2 partidosStyle
    class EquiposMenu,TeamScreen,TeamGrid equiposStyle
    class LiveFilter,LiveBadge,LiveLogic,DisplayLive liveStyle
    class MatchDetail,TeamDetail,PlayerDetail,MatchInfo,PlayerInfo,Stats detailStyle
    class Backend,MatchesTable,TeamsTable,PlayersTable,FavDB backendStyle
    class API,APIFootball,FootballData,ProxyService apiStyle
    class TableBtn,FavMatch,BackToMatch,BackToTeams,BackToTeam actionStyle
